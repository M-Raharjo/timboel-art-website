{{ define "main" }}
<main class="collections">
  <h1 style="text-align: center; padding: 0 2rem;">{{ .Title }}</h1>
  {{ with .Content }}<div class="content">{{ . }}</div>{{ end }}

  {{ if .Sections }}
    {{/* We are on /collections/ → show sub-collections */}}
    <section class="bento-grid bento-description">
      {{ range sort .Sections "Weight" "Title" }}
        {{/* try param "featured_image", else first image resource, else placeholder */}}
        {{ $thumb := .Params.featured_image }}
        {{ if not $thumb }}
          {{ with (first 1 (.Resources.ByType "image")) }}
            {{ $thumb = (index . 0).RelPermalink }}
          {{ end }}
        {{ end }}
        {{ if not $thumb }}
          {{ $thumb = "https://placehold.co/200x200?text=Featured" }}
        {{ end }}
        <a href="{{.RelPermalink}}">
        <div class="bento-item">
          <img src="{{ $thumb }}" alt="{{ .LinkTitle }}" loading="lazy">
            <div>
              <h3>{{ .LinkTitle }}</h3>
              {{ with .Params.description }}<p>{{ . }}</p>{{end}}
            </div>
        </div>
        </a>
      {{ end }}
    </section>

  {{ else if .RegularPages }}
    {{/* We are on /collections/<collection>/ → show items */}}
    <section class="bento-grid bento-description">
      {{ range sort .RegularPages "Weight" "Title" }}
        {{/* item thumb: param or first image resource or placeholder */}}
        {{ $thumb := .Params.featured_image }}
        {{ if not $thumb }}
          {{ with (first 1 (.Resources.ByType "image")) }}
            {{ $thumb = (index . 0).RelPermalink }}
          {{ end }}
        {{ end }}
        {{ if not $thumb }}
          {{ $thumb = printf "https://placehold.co/200x200?text=%s" (urlquery .Params.title) }}
        {{ end }}

        <a href="{{.RelPermalink}}">
        <div class="bento-item">
          <img src="{{ $thumb }}" alt="{{ .LinkTitle }}" loading="lazy">
            <div>
              <h3>{{ .LinkTitle }}</h3>
              <p>{{ .Summary }}</p>
            </div>
        </div>
        </a>
      {{ end }}
    </section>

  {{ else }}
    <p>No content found.</p>
  {{ end }}
</main>
{{ end }}
